---
phase: 3
plan: 3
wave: 2
---

# Plan 3.3: App Synchronization & Telemetry Broadcaster

## Objective
Establish the outbound link from the PC Hub back to the Flutter App, ensuring the student's dashboard dynamically reflects what the system recognized and what sentence it generated.

## Context
- .gsd/SPEC.md
- hub/main_server.py (from Plans 3.1, 3.2)

## Tasks

<task type="auto">
  <name>Build App Sync WebSocket Server</name>
  <files>hub/services/app_sync_service.py</files>
  <action>
    - Ensure `websockets` (asyncio package) is installed.
    - Create a Python async WebSocket server running on `ws://localhost:82`. (Note: Port 81 is the incoming Glove data, Port 82 is the outgoing App Telemetry data).
    - Create an async `broadcast_telemetry(intent, final_sentence)` function.
    - It should construct a JSON payload: `{"type": "telemetry", "intent": intent, "speech": final_sentence}` and instantly send it to all connected Flutter clients.
  </action>
  <verify>python -m py_compile hub/services/app_sync_service.py</verify>
  <done>Python script successfully prepares an async WebSocket server for sending JSON payloads.</done>
</task>

<task type="auto">
  <name>Wire Sync Service into Main Server Loop</name>
  <files>hub/main_server.py</files>
  <action>
    - Import the async routines from `app_sync_service.py`.
    - Modify the `main_server.py` runtime to handle `asyncio` if it isn't already.
    - Right after `generate_fluent_speech` resolves in the main loop, call `broadcast_telemetry` to instantly pipe the result to the UI.
  </action>
  <verify>python -m py_compile hub/main_server.py</verify>
  <done>Main hub coordinates the full pipeline: Input (WS 81) -> Engine -> Intent -> Output (WS 82).</done>
</task>

## Success Criteria
- [ ] A dedicated UI telemetry websocket server is active.
- [ ] The full end-to-end data flow (Input Array -> Intent Engine -> UI Telemetry) is wired in Python.
